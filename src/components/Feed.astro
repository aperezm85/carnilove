---
import EastIcon from "@/assets/icons/east.svg";
import ButtonRed from "@/components/shared/ButtonRed.astro";
import DoubleHeading from "@/components/shared/DoubleHeading.astro";

import Placeholder from "@/assets/feed-nature/video-placeholder.jpg";
---

<section
  id="feed-their-nature"
  class="pin-section relative flex flex-row items-center justify-center h-screen w-full gap-6 bg-surface-background-minimal"
>
  <section class="flex flex-col max-w-[550px]">
    <DoubleHeading
      id="feed-their-nature-title"
      className="max-w-[550px] z-2"
      first="Feed their"
      second="true nature."
    />

    <h2
      class="font-heading font-extrabold text-[34px]/[38px] uppercase text-text-primary max-w-[530px]"
    >
      Instinct-driven nutrition for the natural carnivore in every pet
    </h2>

    <p class="text-sm/[22px] text-text-primary max-w-[530px]">
      High-meat recipes with no grains or fillers. Pure, powerful nutrition that
      ignites their spirit.
    </p>

    <ButtonRed
      className="mt-[30px] flex flex-row items-center gap-1.5 self-start"
    >
      Discover Their Wild Side <EastIcon class="w-6 h-6" />
    </ButtonRed>
  </section>
  <img
    id="video-feed-placeholder"
    src={Placeholder.src}
    class="aspect-433/532 w-[433px] h-[532px]"
  />
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  import { SplitText } from "gsap/SplitText";

  gsap.registerPlugin(ScrollTrigger, SplitText);

  const feedTitle = document.getElementById("feed-their-nature-title");
  const videoFeedPlaceholder = document.getElementById(
    "video-feed-placeholder"
  );

  if (feedTitle) {
    // Run SplitText only after fonts are loaded to ensure correct measurements.
    const initSplitText = () => {
      // If SplitText was already applied, kill previous instance (defensive)
      try {
        // Create SplitText on the actual element node rather than a string selector
        const mySplitText = new SplitText(feedTitle, { type: "chars" });
        const chars = mySplitText.chars;

        gsap.from(chars, {
          yPercent: 130,
          stagger: 0.02,
          ease: "back.out",
          duration: 1,
          scrollTrigger: {
            trigger: feedTitle,
            start: "top 50%",
            toggleActions: "play reverse restart restart",
          },
        });
      } catch (err) {
        // If SplitText fails for any reason, log and bail gracefully
        console.warn("SplitText init failed:", err);
      }
    };

    if (document.fonts && document.fonts.ready) {
      // Wait for all fonts declared in CSS to be loaded
      document.fonts.ready.then(initSplitText).catch(initSplitText);
    } else {
      // Fallback: wait for window load
      window.addEventListener("load", initSplitText, { once: true });
    }
  }

  if (videoFeedPlaceholder) {
    gsap.from(videoFeedPlaceholder, {
      yPercent: 130,
      stagger: 0.02,
      ease: "back.out",
      duration: 1,
      scrollTrigger: {
        trigger: feedTitle,
        start: "top 50%",
        end: "bottom 40%",
        toggleActions: "play reset restart reset",
      },
    });
  }
</script>
