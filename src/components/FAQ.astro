---
import Footer from "@/components/Footer.astro";
import Accordion from "@/components/shared/Accordion.astro";

import Cat from "@/assets/faq/footer-cat.gif";
import Dog from "@/assets/faq/footer-dog.gif";
---

<section
  id="FAQ"
  class="pin-section w-full bg-text-secondary text-text-invert min-h-dvh flex flex-col justify-between z-20 relative overflow-auto"
>
  <div class="relative grow">
    <div
      id="faq_title"
      class="flex flex-col gap-5 items-center max-w-[800px] mx-auto pt-[86px] pb-[50px]"
    >
      <h1 class="font-large-heading text-[60px]/[80%] uppercase">
        Frequently Asked Questions
      </h1>
      <p class="font-copy text-base/[24px] text-center">
        Curious about Carnilove? You’re not alone. Here are some of the most
        common questions from fellow dog and cat lovers — all answered by our
        team of nutrition and pet care experts.
      </p>
    </div>

    <div
      id="faq_questions"
      class="flex flex-col gap-2 w-[715px] max-w-[90%] ml-40 pb-[100px] z-10"
    >
      <Accordion
        title="What makes Carnilove different from other pet foods?"
        content="Carnilove is crafted to mirror the natural diet of wild dogs and cats. Every recipe is rich in meat, balanced with forest fruits, vegetables, and herbs — no grains, no artificial additives, just real nutrition inspired by nature."
      />
      <Accordion
        title="Is Carnilove suitable for all breeds and sizes?"
        content="Yes — our recipes are designed for all breeds and activity levels. Each formula is nutritionally balanced, and we offer specific options for puppies, adults, seniors, and active pets to ensure the perfect fit for every member of your pack."
      />
      <Accordion
        title="Do you use artificial colours or preservatives?"
        content="Never. We believe in pure, honest nutrition. Our food is preserved naturally and coloured only by the real ingredients inside — because nature doesn’t need enhancements."
      />
      <Accordion
        title="Can I mix Carnilove dry and wet food?"
        content="Absolutely. Many pet owners mix the two for added variety and hydration. Our dry and wet formulas are designed to complement each other, giving your pet a complete and satisfying meal."
      />
      <Accordion
        title="Where is Carnilove made?"
        content="All Carnilove recipes are made in the heart of Europe, using responsibly sourced ingredients from trusted farms and fisheries. Each batch is carefully crafted to meet the highest standards of quality and safety."
      />
    </div>

    <div class="absolute inset-0 w-full h-full">
      <img
        id="footer-dog"
        data-src={Dog.src}
        src=""
        alt="Happy dog"
        class="absolute -bottom-2.5 left-[806px] w-[634px] h-[428px]"
        onerror="this.style.display='none';"
      />

      <img
        id="footer-cat"
        data-src={Cat.src}
        src=""
        alt="Happy cat"
        class="absolute -bottom-10 left-[848px] w-[591px] h-[327px]"
        onerror="this.style.display='none';"
      />
    </div>
  </div>
  <Footer />
</section>

<script>
  import { gsap } from "gsap";

  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  const trigger = document.getElementById("FAQ");
  const faqQuestions = document.getElementById("faq_questions");
  const faqTitle = document.getElementById("faq_title");

  gsap.from("#FAQ", {
    backgroundColor: "#fff3e4",
    // duration: 1.5,
    ease: "power2.inOut",
    scrollTrigger: {
      trigger: trigger,
      start: "top bottom",
      end: "bottom top",
      scrub: false,
    },
  });

  gsap
    .timeline({
      scrollTrigger: {
        trigger: trigger,
        start: "top 80%",
        end: "bottom top",
        scrub: false,
      },
    })
    .from(faqQuestions, {
      xPercent: -100,
      opacity: 0,
      // duration: 1,
      ease: "power2.out",
    })
    .from(
      faqTitle,
      {
        yPercent: 50,
        opacity: 0,
        // duration: 1,
        ease: "power2.out",
      },
      "-=0.5"
    );

  ScrollTrigger.create({
    trigger: trigger,
    start: "top 5%",
    onEnter: () => {
      setTimeout(() => {
        document.getElementById("footer-dog")!.style.display = "block";
        document.getElementById("footer-cat")!.style.display = "block";
        (document.getElementById("footer-dog") as HTMLImageElement).src = (
          document.getElementById("footer-dog") as HTMLImageElement
        ).getAttribute("data-src") as string;
        (document.getElementById("footer-cat") as HTMLImageElement).src = (
          document.getElementById("footer-cat") as HTMLImageElement
        ).getAttribute("data-src") as string;
      }, 500);
    },

    onEnterBack: () => {
      setTimeout(() => {
        document.getElementById("footer-dog")!.style.display = "block";
        document.getElementById("footer-cat")!.style.display = "block";
        (document.getElementById("footer-dog") as HTMLImageElement).src = (
          document.getElementById("footer-dog") as HTMLImageElement
        ).getAttribute("data-src") as string;
        (document.getElementById("footer-cat") as HTMLImageElement).src = (
          document.getElementById("footer-cat") as HTMLImageElement
        ).getAttribute("data-src") as string;
      }, 500);
    },
  });

  ScrollTrigger.create({
    trigger: trigger,
    start: "top top",
    end: "+=50%", // Adjust based on GIF duration
    // pin: true,
    scrub: true,
    onEnter: (self) => {
      if (self.progress > 0.01) {
        document.getElementById("footer-dog")!.style.display = "none";
        document.getElementById("footer-cat")!.style.display = "none";
      }
    },
    onEnterBack: (self) => {
      if (self.progress > 0.01) {
        document.getElementById("footer-dog")!.style.display = "none";
        document.getElementById("footer-cat")!.style.display = "none";
      }
    },
  });

  // Expose playEntry/playLeave on FAQ root
  const faqRoot = document.getElementById("FAQ");
  if (faqRoot) {
    (faqRoot as any).playEntry = function () {
      return;
    };

    (faqRoot as any).playLeave = function () {
      return;
    };
  }
</script>
