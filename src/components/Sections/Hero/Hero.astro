---
import Header from "@/components/Header.astro";

import ChevronRightIcon from "@/assets/icons/chevron-right.svg";
import ChevronLeftIcon from "@/assets/icons/chevron-left.svg";
import Hero1 from "@/components/Sections/Hero/Hero1.astro";
import Hero2 from "@/components/Sections/Hero/Hero2.astro";
import ParallaxSection from "@/components/ParallaxSection.astro";
---

<ParallaxSection
  id="hero"
  class="relative"
  bgPosition={[
    { y: 100, opacity: 0 },
    { y: 100, opacity: 0 },
    { y: 100, opacity: 0 },
  ]}
>
  <Header />
  <Hero1 />
  <Hero2 />

  <section
    id="buttons"
    class="absolute top-1/2 w-full flex flex-row justify-between"
  >
    <button id="left-button" type="button" class="carousel-button ml-4">
      <ChevronLeftIcon class="w-6 h-6" />
    </button>
    <button id="right-button" type="button" class="carousel-button mr-4">
      <ChevronRightIcon class="w-6 h-6" />
    </button>
  </section>
</ParallaxSection>

<script>
  import { gsap } from "gsap";

  const hero1 = document.getElementById("hero-1");
  const hero2 = document.getElementById("hero-2");
  const leftButton = document.getElementById("left-button");
  const rightButton = document.getElementById("right-button");

  gsap.set(hero2, { x: "100%" });

  const tl = gsap.timeline({
    defaults: {
      ease: "none",
      duration: 0.5,
    },
  });

  let currentSlide = 0;
  const numSlides = 2;
  leftButton?.addEventListener("click", () => {
    changeSlide((currentSlide - 1 + numSlides) % numSlides);
  });

  rightButton?.addEventListener("click", () => {
    changeSlide((currentSlide + 1) % numSlides);
  });

  function changeSlide(nextSlide: number) {
    if (nextSlide === 0) {
      tl.to(hero1, {
        x: "0%",
      }).fromTo(
        hero2,
        {
          x: "0%",
        },
        {
          x: "100%",
        },
        "<"
      );
    } else if (nextSlide === 1) {
      tl.to(hero1, {
        x: "-100%",
      }).fromTo(
        hero2,
        {
          x: "100%",
        },
        {
          x: "0%",
        },
        "<"
      );
    }
    currentSlide = nextSlide;
  }

  // Expose playEntry/playLeave on the section root so parent can coordinate animations
  const heroRoot = document.getElementById("hero");
  if (heroRoot) {
    (heroRoot as any).playEntry = function () {
      // return gsap.fromTo(
      //   heroRoot.querySelectorAll(".header, #hero-1, #hero-2, #buttons"),
      //   { opacity: 0, y: 20 },
      //   { opacity: 1, y: 0, duration: 0.6, stagger: 0.05, ease: "power2.out" }
      // );
    };

    (heroRoot as any).playLeave = function () {
      // return gsap.to(
      //   heroRoot.querySelectorAll(".header, #hero-1, #hero-2, #buttons"),
      //   {
      //     opacity: 0,
      //     y: -20,
      //     duration: 0.5,
      //     stagger: 0.03,
      //     ease: "power2.in",
      //   }
      // );
    };
  }
</script>
